{
    "version": "Notebook/1.0",
    "items": [
        {
            "type": 3,
            "content": {
                "version": "KqlItem/1.0",
                "query": "let GeoIPDB_FULL = _GetWatchlist(\"geoip\");\nlet WindowsEvents = SecurityEvent;\nWindowsEvents\n| where EventID == 4625\n| order by TimeGenerated desc\n| evaluate ipv4_lookup(GeoIPDB_FULL, IpAddress, network)\n| extend cityname = iff(isempty(cityname) or cityname == \"-\", \"Unknown City\", cityname)\n| extend countryname = iff(isempty(countryname) or countryname == \"-\", \"Unknown Country\", countryname)\n| summarize FailureCount = count() by IpAddress, latitude, longitude, cityname, countryname\n| extend friendly_location = strcat(cityname, \" (\", countryname, \")\")\n",
                "size": 3,
                "timeContext": {
                    "durationMs": 2592000000
                },
                "queryType": 0,
                "resourceType": "microsoft.operationalinsights/workspaces",
                "visualization": "map",
                "mapSettings": {
                    "locInfo": "LatLong",
                    "latitude": "latitude",
                    "longitude": "longitude",
                    "sizeSettings": "FailureCount",
                    "sizeAggregation": "Sum",
                    "opacity": 0.8,
                    "labelSettings": "friendly_location",
                    "legendMetric": "FailureCount",
                    "legendAggregation": "Sum",
                    "itemColorSettings": {
                        "nodeColorField": "FailureCount",
                        "colorAggregation": "Sum",
                        "type": "heatmap",
                        "heatmapPalette": "greenRed"
                    }
                },
                "crossComponentResources": [
                    "/subscriptions/439cdb70-65f4-48ac-a6d9-64ad6be62c6c/resourceGroups/rg-soclab/providers/Microsoft.OperationalInsights/workspaces/law-soclab"
                ]
            },
            "name": "query - 0",
            "id": "85186cee-ccc8-496e-95b5-1b94ab0aaf1d"
        }
    ],
    "isLocked": false,
    "styleSettings": {},
    "fromTemplateId": "sentinel-UserWorkbook",
    "context": {
        "ownerId": "/subscriptions/439cdb70-65f4-48ac-a6d9-64ad6be62c6c/resourceGroups/rg-soclab/providers/Microsoft.OperationalInsights/workspaces/law-soclab"
    },
    "fallbackResourceIds": [
        "/subscriptions/439cdb70-65f4-48ac-a6d9-64ad6be62c6c/resourcegroups/rg-soclab/providers/microsoft.operationalinsights/workspaces/law-soclab"
    ]
}